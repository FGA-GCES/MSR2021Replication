Javascript wait for condition to be true using promise
